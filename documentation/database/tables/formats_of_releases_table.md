# Trigger on insert and on update

- If "jukebox_hole" is true, corresponding format's "short_name" should be "7''" - if does not, exception is thrown and operation is rolled back \*
- If "amount" is not a positive integer an exception is thrown and operation is rolled back \*
- Value of "speed" is allowed to be non null only if corresponding format has a non-null value for "default speed". If does not, exception is thrown and operation is rolled back \*. Otherwise the jsonb value of "speed" is validated as follows. It can be either a string or an object. If it is a string, it's trimmed and then it must correspond to one of the values of "VINYL_SPEED" type (enum) but is not allowed to have the same value as the "default speed" of the corresponding format (rationale being that "speed" field should only be used to indicate values different from the default ones). It it is an object, its keys must confirm to the regex `^Side ([A-Z]|AA)$` and the value of every key must be a string that goes through the validation for string value of "speed" described above. In case value of "speed" does not go through validation exception is thrown and operation is rolled back \*. In other case all values for "speed" evaluated as before are trimmed before record is inserted or updated in DB.

\* All critical validation errors are collected before throwing an exception. Every error message is pruned of a new line character (it is replaced by a regular space). In the final error message passed with exception all these error messages are concatenated using a new line character as a separator.
