The file documents the validation logic "validate_release_matrix_runout_jsonb" function executes.

Function "validate_release_matrix_runout_jsonb" takes a jsonb value "matrix_runout_value" meant for "matrix_runout" column in "musical_releases" table and validates it according to the logic and rules described in this file. It also takes a "messages_prefix" (string) and "validation_errors" (array of strings) parameters. Whenever function finds a validation error, it appends it to "validation_errors" array that was passed as a parameter. In the end function returns "validation_errors" array back as well as a "validated_value" which should be used as a final "validated" value for "matrix_runout" column.

- If "matrix_runout_value" is NULL it is returned as such.
- If "matrix_runout_value" is null as jsonb, function returns a standard postgres NULL value. A notice is raised about this.
- Otherwise "matrix_runout_value" must be a string or an object, whose shape is described below.
- If "matrix_runout_value" is a string, it's trimmed and if the trimmed value is different from original value, a notification is raised about it.
- If "matrix_runout_value" is an object, there are three possibilities, which we shall call "mirrored case shape", "vinyl case shape" and "digital case shape.
- In "mirrored case shape" case, object must have "mirrored" property and is also allowed to have "normal" property. Both property's value must be a string. This string is trimmed and if the trimmed value is different from original value, a notification is raised about it.
- In "vinyl case shape" case, object is allowed to have the following keys: "Mono side", "Stereo side", "Both A sides", "Side AA" or satisfy a regex ^Side [A-Z]$. At least one key is mandatory. If one of the keys is "Mono side" or "Stereo side", both of these keys mist be present and no other keys are allowed. If one of the keys is "Both A sides", no other keys are allowed. If one of the keys is "Side AA", also key "Side A" must be present and no other keys are allowed. Finally if none of these possibilities was satisfied, a key "Side A" or "Side X" must be present, and the letters [A-Z] in "^Side [A-Z]$" must form a consecutive list of letters with no gaps.
- In "vinyl case shape" case, value of each key must be either a string, or an object with mandatory key "etched" and optional keys "stamped" and "comment", no other keys are allowed. Values behind each key must be strings. All final string values are trimmed and if the trimmed value is different from original value, a notification is raised about it.
- In "digital case shape" case, object is allowed to have the following keys: "3'CD", "LP" or satisfy a regex ^(CD|DVD|BD|4HD_BD)[1-9]?\d\*$. The latter are also subjected to the following rule - for all keys that start with "CD" or "DVD" or "BD" or "4HD_BD" either only a key with no numbers in it is allowed, or numbers must start with 1 and form a consecutive list of integers with no gaps.
- In "digital case shape" case, value of each key must be either a string, or an object satisfying "mirrored case shape" as described above, with the exception of the key "LP". Value of this key must confirm to "vinyl case shape". As usual all final string values are trimmed and if the trimmed value is different from original value, a notification is raised about it.

If in the end "validation_errors" array is non empty, the "validated_value" function also returns is not guaranteed to be actually valid and should not be used.
