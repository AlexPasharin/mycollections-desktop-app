model MusicalRelease {
  id                    String  @id @default(dbgenerated("gen_random_uuid()")) @map("release_id") @db.Uuid
  alternativeName       String? @map("release_alternative_name") // used when release's name is different from it's entry's main name
  version               String  @map("release_version")
  releaseDate           String? @map("release_date")
  discogsUrl            String? @map("discogs_url")
  countries             Json?
  catalogueNumbers      Json?   @map("catalogue_numbers")
  matrixRunout          Json?   @map("matrix_runout")
  comment               String?
  conditionProblems     String? @map("condition_problems")
  partOfQueenCollection Boolean @default(false) @map("part_of_queen_collection")
  relationToQueen       String? @map("relation_to_queen")

  entryId String @map("entry_id") @db.Uuid

  entry              MusicalEntry                      @relation(fields: [entryId], references: [id])
  formats            FormatOfRelease[]
  alternativeArtists MusicalReleaseAlternativeArtist[]
  tags               MusicalReleaseTag[]
  parentReleases     ParentMusicalRelease[]            @relation("ParentRelease")
  childReleases      ParentMusicalRelease[]            @relation("ChildRelease")

  @@map("musical_releases")
}

enum VINYL_SPEED {
  SPEED_33
  SPEED_45
}

model ReleaseFormat {
  id           String       @id @default(dbgenerated("gen_random_uuid()")) @map("format_id") @db.Uuid
  shortName    String       @unique @map("short_name")
  description  String       @unique
  hasSides     Boolean      @map("has_sides")
  defaultSpeed VINYL_SPEED? @map("default_speed")

  releases FormatOfRelease[]

  @@map("releases_formats")
}

model FormatOfRelease {
  id            String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  releaseId     String  @map("release_id") @db.Uuid
  formatId      String  @map("format_id") @db.Uuid
  jukeboxHole   Boolean @default(false) @map("jukebox_hole")
  pictureSleeve Boolean @default(true) @map("picture_sleeve")
  speed         Json? // if differs from default
  amount        Int // amount of parts of release of this format with same other column values

  release MusicalRelease @relation(fields: [releaseId], references: [id])
  format  ReleaseFormat  @relation(fields: [formatId], references: [id])

  @@unique([releaseId, formatId, jukeboxHole, pictureSleeve, speed])
  @@map("formats_of_releases")
}

model Country {
  codeName String @id @map("code_name")
  name     String @unique

  @@map("countries")
}

model MusicalReleaseAlternativeArtist {
  releaseId             String  @map("release_id") @db.Uuid
  artistId              String  @map("artist_id") @db.Uuid
  alternativeArtistName String? @map("alternative_artist_name") // used when release's artist use for release one of it's "other names"

  release MusicalRelease @relation(fields: [releaseId], references: [id])
  artist  Artist         @relation(fields: [artistId], references: [id])

  @@id([releaseId, artistId])
  @@map("musical_release_alternative_artists")
}

model ParentMusicalRelease {
  parentRelease   MusicalRelease @relation("ParentRelease", fields: [parentReleaseId], references: [id])
  parentReleaseId String         @map("parent_release_id") @db.Uuid

  childRelease   MusicalRelease @relation("ChildRelease", fields: [childReleaseId], references: [id])
  childReleaseId String         @map("child_release_id") @db.Uuid

  @@id([parentReleaseId, childReleaseId])
  @@map("parent_musical_releases")
}

model Label {
  id   String @id @default(dbgenerated("gen_random_uuid()")) @map("label_id") @db.Uuid
  name String @unique

  @@map("labels")
}
